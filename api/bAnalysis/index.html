
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Current Clamp Analysis For Cardiac Myocytes">
      
      
      
        <meta name="author" content="Robert H Cudmore">
      
      
      <link rel="icon" href="../../img/sanpy-transparent.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.6">
    
    
      
        <title>bAnalysis - SanPy Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.875de78c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/style.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sanpy.bAnalysis.bAnalysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SanPy Documentation" class="md-header__button md-logo" aria-label="SanPy Documentation" data-md-component="logo">
      
  <img src="../../img/sanpy-transparent.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SanPy Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              bAnalysis
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/cudmore/sanpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    SanPy Repository
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SanPy Documentation" class="md-nav__button md-logo" aria-label="SanPy Documentation" data-md-component="logo">
      
  <img src="../../img/sanpy-transparent.png" alt="logo">

    </a>
    SanPy Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cudmore/sanpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    SanPy Repository
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        SanPy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../desktop-application/" class="md-nav__link">
        Desktop Application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../web-application/" class="md-nav__link">
        Web Application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        Install
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../methods/" class="md-nav__link">
        Methods
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      <label class="md-nav__link" for="__nav_7">
        Scripting
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Scripting" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Scripting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scripting/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scripting/examples/" class="md-nav__link">
        Examples
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scripting/plotting-analysis/" class="md-nav__link">
        Plotting Analysis
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      <label class="md-nav__link" for="__nav_8">
        API
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          bAnalysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        bAnalysis
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis" class="md-nav__link">
    bAnalysis
  </a>
  
    <nav class="md-nav" aria-label="bAnalysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.abf" class="md-nav__link">
    abf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.api_getHeader" class="md-nav__link">
    api_getHeader()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.api_getRecording" class="md-nav__link">
    api_getRecording()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.api_getSpikeInfo" class="md-nav__link">
    api_getSpikeInfo()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.api_getSpikeStat" class="md-nav__link">
    api_getSpikeStat()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.dataPointsPerMs" class="md-nav__link">
    dataPointsPerMs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.errorReport" class="md-nav__link">
    errorReport()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getDefaultDetection" class="md-nav__link">
    getDefaultDetection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getDefaultDetection_ca" class="md-nav__link">
    getDefaultDetection_ca()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getSpikeClips" class="md-nav__link">
    getSpikeClips()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getStat" class="md-nav__link">
    getStat()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getStatMean" class="md-nav__link">
    getStatMean()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.makeSpikeClips" class="md-nav__link">
    makeSpikeClips()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.ms2Pnt_" class="md-nav__link">
    ms2Pnt_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.numSpikes" class="md-nav__link">
    numSpikes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.numSweeps" class="md-nav__link">
    numSweeps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.openHeaderInBrowser" class="md-nav__link">
    openHeaderInBrowser()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.pnt2Ms_" class="md-nav__link">
    pnt2Ms_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.pnt2Sec_" class="md-nav__link">
    pnt2Sec_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.recodingDur" class="md-nav__link">
    recodingDur
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.recordingFrequency" class="md-nav__link">
    recordingFrequency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.save_csv" class="md-nav__link">
    save_csv()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.setSweep" class="md-nav__link">
    setSweep()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.spikeDetect" class="md-nav__link">
    spikeDetect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.sweepList" class="md-nav__link">
    sweepList
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.logger--was-used-to-check-for-valid-pyabf-but-we-are-now-detached-from-this" class="md-nav__link">
    was used to check for valid pyAbf but we are now detached from this
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bAnalysisPlot/" class="md-nav__link">
        bAnalysisPlot
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bAnalysisDir/" class="md-nav__link">
        bAnalysisDir
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bExport/" class="md-nav__link">
        bExport
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../detectionParams/" class="md-nav__link">
        detectionParams
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bAnalysisUtil/" class="md-nav__link">
        bAnalysisUtil
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_8" data-md-state="indeterminate" type="checkbox" id="__nav_8_8" checked>
      
      <label class="md-nav__link" for="__nav_8_8">
        interface
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="interface" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_8">
          <span class="md-nav__icon md-icon"></span>
          interface
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../interface/sanpy_app/" class="md-nav__link">
        sanp_app
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../open-source/" class="md-nav__link">
        Open Source
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis" class="md-nav__link">
    bAnalysis
  </a>
  
    <nav class="md-nav" aria-label="bAnalysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.abf" class="md-nav__link">
    abf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.api_getHeader" class="md-nav__link">
    api_getHeader()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.api_getRecording" class="md-nav__link">
    api_getRecording()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.api_getSpikeInfo" class="md-nav__link">
    api_getSpikeInfo()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.api_getSpikeStat" class="md-nav__link">
    api_getSpikeStat()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.dataPointsPerMs" class="md-nav__link">
    dataPointsPerMs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.errorReport" class="md-nav__link">
    errorReport()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getDefaultDetection" class="md-nav__link">
    getDefaultDetection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getDefaultDetection_ca" class="md-nav__link">
    getDefaultDetection_ca()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getSpikeClips" class="md-nav__link">
    getSpikeClips()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getStat" class="md-nav__link">
    getStat()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.getStatMean" class="md-nav__link">
    getStatMean()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.makeSpikeClips" class="md-nav__link">
    makeSpikeClips()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.ms2Pnt_" class="md-nav__link">
    ms2Pnt_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.numSpikes" class="md-nav__link">
    numSpikes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.numSweeps" class="md-nav__link">
    numSweeps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.openHeaderInBrowser" class="md-nav__link">
    openHeaderInBrowser()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.pnt2Ms_" class="md-nav__link">
    pnt2Ms_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.pnt2Sec_" class="md-nav__link">
    pnt2Sec_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.recodingDur" class="md-nav__link">
    recodingDur
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.recordingFrequency" class="md-nav__link">
    recordingFrequency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.save_csv" class="md-nav__link">
    save_csv()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.setSweep" class="md-nav__link">
    setSweep()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.spikeDetect" class="md-nav__link">
    spikeDetect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.bAnalysis.sweepList" class="md-nav__link">
    sweepList
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sanpy.bAnalysis.logger--was-used-to-check-for-valid-pyabf-but-we-are-now-detached-from-this" class="md-nav__link">
    was used to check for valid pyAbf but we are now detached from this
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>bAnalysis</h1>
                
                <div class="doc doc-object doc-module">


    <div class="doc doc-contents first">




  <div class="doc doc-children">




  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis">
        <code>bAnalysis</code>



<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis" title="Permanent link">¤</a></h2>

    <div class="doc doc-contents ">

      <p>The bAnalysis class represents a whole-cell recording.</p>
<p>This can be created in a number of ways:
        1. An .abf file path.
        2. A .csv file path with time and mV columns.
        3. a byteStream abf when working in the cloud.</p>
<p>Once loaded, a number of operations can be performed including:
 - Spike detection,
 - Error checking
 - Saving</p>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;data/19114001.abf&#39;</span>
<span class="n">ba</span> <span class="o">=</span> <span class="n">bAnalysis</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">dDict</span> <span class="o">=</span> <span class="n">ba</span><span class="o">.</span><span class="n">getDefaultDetection</span><span class="p">()</span>
<span class="n">ba</span><span class="o">.</span><span class="n">spikeDetect</span><span class="p">(</span><span class="n">dDict</span><span class="p">)</span>
</code></pre></div>




  <div class="doc doc-children">




  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theTiff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byteStream</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.__init__" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Initialize a bAnalysis object</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file</code></td>
        <td><code>str</code></td>
        <td><p>Path to either .abf or .csv with time/mV columns.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>theTiff</code></td>
        <td><code>str</code></td>
        <td><p>Path to .tif file.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>byteStream</code></td>
        <td><code>binary</code></td>
        <td><p>Binary stream for use in the cloud.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theTiff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byteStream</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Initialize a bAnalysis object</span>

<span class="sd">	Args:</span>
<span class="sd">		file (str): Path to either .abf or .csv with time/mV columns.</span>
<span class="sd">		theTiff (str): Path to .tif file.</span>
<span class="sd">		byteStream (binary): Binary stream for use in the cloud.</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1">#</span>
	<span class="c1"># mimic pyAbf</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_dataPointsPerMs</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_sweepList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># list</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_currentSweep</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># int</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_sweepX</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># np.ndarray</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_sweepY</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># np.ndarray</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">_recordingMode</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># str</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_sweepX_label</span> <span class="o">=</span> <span class="s1">&#39;???&#39;</span> <span class="c1"># str</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_sweepY_label</span> <span class="o">=</span> <span class="s1">&#39;???&#39;</span> <span class="c1"># str</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">myFileType</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="sd">&quot;&quot;&quot;str: From (&#39;abf&#39;, &#39;csv&#39;, &#39;tif&#39;, &#39;bytestream&#39;)&quot;&quot;&quot;</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">loadError</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># abb 20201109</span>
	<span class="sd">&quot;&quot;&quot;bool: True if error loading file/stream.&quot;&quot;&quot;</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">detectionDict</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># remember the parameters of our last detection</span>
	<span class="sd">&quot;&quot;&quot;dict: Dictionary specifying detection parameters, see getDefaultDetection.&quot;&quot;&quot;</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">file</span> <span class="c1"># todo: change this to filePath</span>
	<span class="sd">&quot;&quot;&quot;str: File path.&quot;&quot;&quot;</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">_abf</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="sd">&quot;&quot;&quot;pyAbf: If loaded from binary abf file&quot;&quot;&quot;</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">dateAnalyzed</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="sd">&quot;&quot;&quot;str: Date Time of analysis. TODO: make a property.&quot;&quot;&quot;</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">detectionType</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="sd">&quot;&quot;&quot;str: From (&#39;dvdt&#39;, &#39;mv&#39;)&quot;&quot;&quot;</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">filteredVm</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">filteredDeriv</span> <span class="o">=</span> <span class="kc">None</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># a list of dict</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># created in self.spikeDetect()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># created in self.spikeDetect()</span>

	<span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
		<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File does not exist: &quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">loadError</span> <span class="o">=</span> <span class="kc">True</span>

	<span class="c1"># only defined when loading abf files</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">acqDate</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">acqTime</span> <span class="o">=</span> <span class="kc">None</span>

	<span class="c1"># instantiate and load abf file</span>
	<span class="k">if</span> <span class="n">byteStream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_abf</span> <span class="o">=</span> <span class="n">pyabf</span><span class="o">.</span><span class="n">ABF</span><span class="p">(</span><span class="n">byteStream</span><span class="p">)</span> <span class="c1"># my cloned pyAbf to load a byte-stream</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myFileType</span> <span class="o">=</span> <span class="s1">&#39;bytestream&#39;</span>

	<span class="k">elif</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_loadTif</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_loadCsv</span><span class="p">()</span>

	<span class="k">elif</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.abf&#39;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_loadAbf</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error: bAnalysis.__init__() can only open abf/csv/tif files: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">loadError</span> <span class="o">=</span> <span class="kc">True</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">currentSweep</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">setSweep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">filteredVm</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">filteredDeriv</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="c1"># get default derivative</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordingMode</span> <span class="o">==</span> <span class="s1">&#39;I-Clamp&#39;</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_getDerivative</span><span class="p">()</span>
	<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordingMode</span> <span class="o">==</span> <span class="s1">&#39;V-Clamp&#39;</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_getBaselineSubtract</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Did not take derivative&#39;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.abf">
<code class="highlight language-python"><span class="n">abf</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.abf" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get the underlying pyabf object.</p>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.api_getHeader">
<code class="highlight language-python"><span class="n">api_getHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.api_getHeader" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get header as a dict.</p>
<div class="admonition todo">
<p class="admonition-title">Todo<ul>
<li>add info on abf file, like samples per ms</li>
</ul>
</p>
</div>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Dictionary of information aboiut loaded file.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">api_getHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Get header as a dict.</span>

<span class="sd">	TODO:</span>
<span class="sd">		- add info on abf file, like samples per ms</span>

<span class="sd">	Returns:</span>
<span class="sd">		dict: Dictionary of information aboiut loaded file.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">recordingDir_sec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweepX</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span> <span class="o">/</span> <span class="mi">1000</span>
	<span class="n">recordingFrequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;myFileType&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">myFileType</span><span class="p">,</span> <span class="c1"># (&#39;abf&#39;, &#39;tif&#39;, &#39;bytestream&#39;, &#39;csv&#39;)</span>
		<span class="s1">&#39;loadError&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadError</span><span class="p">,</span>
		<span class="s1">&#39;detectionDict&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">detectionDict</span><span class="p">,</span>
		<span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span>
		<span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
		<span class="s1">&#39;dateAnalyzed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dateAnalyzed</span><span class="p">,</span>
		<span class="s1">&#39;detectionType&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">detectionType</span><span class="p">,</span>
		<span class="s1">&#39;acqDate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">acqDate</span><span class="p">,</span>
		<span class="s1">&#39;acqTime&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">acqTime</span><span class="p">,</span>
		<span class="c1">#</span>
		<span class="s1">&#39;_recordingMode&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordingMode</span><span class="p">,</span>
		<span class="s1">&#39;get_yUnits&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yUnits</span><span class="p">,</span>
		<span class="s1">&#39;currentSweep&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentSweep</span><span class="p">,</span>
		<span class="s1">&#39;recording_kHz&#39;</span><span class="p">:</span> <span class="n">recordingFrequency</span><span class="p">,</span>
		<span class="s1">&#39;recordingDur_sec&#39;</span><span class="p">:</span> <span class="n">recordingDir_sec</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.api_getRecording">
<code class="highlight language-python"><span class="n">api_getRecording</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.api_getRecording" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Return primary recording</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>{'header', 'sweepX', 'sweepY'}</p></td>
    </tr>
  </tbody>
</table>      <div class="admonition todo">
<p class="admonition-title">Todo<p>Add param to only get every n'th point, to return a subset faster (for display)</p>
</p>
</div>

        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">api_getRecording</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Return primary recording</span>

<span class="sd">	Returns:</span>
<span class="sd">		dict: {&#39;header&#39;, &#39;sweepX&#39;, &#39;sweepY&#39;}</span>

<span class="sd">	TODO:</span>
<span class="sd">		Add param to only get every n&#39;th point, to return a subset faster (for display)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1">#start = time.time()</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;header&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_getHeader</span><span class="p">(),</span>
		<span class="s1">&#39;sweepX&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweepX</span><span class="p">,</span>
		<span class="s1">&#39;sweepY&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweepY</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="c1">#stop = time.time()</span>
	<span class="c1">#print(stop-start)</span>
	<span class="k">return</span> <span class="n">ret</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.api_getSpikeInfo">
<code class="highlight language-python"><span class="n">api_getSpikeInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spikeNum</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.api_getSpikeInfo" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get info about each spike.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>spikeNum</code></td>
        <td><code>int</code></td>
        <td><p>Get info for one spike, None for all spikes.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>List of dict with info for all (one) spike.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">api_getSpikeInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spikeNum</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Get info about each spike.</span>

<span class="sd">	Args:</span>
<span class="sd">		spikeNum (int): Get info for one spike, None for all spikes.</span>

<span class="sd">	Returns:</span>
<span class="sd">		list: List of dict with info for all (one) spike.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">spikeNum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">spikeNum</span><span class="p">]]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span>
	<span class="k">return</span> <span class="n">ret</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.api_getSpikeStat">
<code class="highlight language-python"><span class="n">api_getSpikeStat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.api_getSpikeStat" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get stat for each spike</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>stat</code></td>
        <td><code>str</code></td>
        <td><p>The name of the stat to get. Corresponds to key in self.spikeDict[i].</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>List of values for 'stat'. Ech value is for one spike.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">api_getSpikeStat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Get stat for each spike</span>

<span class="sd">	Args:</span>
<span class="sd">		stat (str): The name of the stat to get. Corresponds to key in self.spikeDict[i].</span>

<span class="sd">	Returns:</span>
<span class="sd">		list: List of values for &#39;stat&#39;. Ech value is for one spike.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">statList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStat</span><span class="p">(</span><span class="n">statName1</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">statName2</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">statList</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.dataPointsPerMs">
<code class="highlight language-python"><span class="n">dataPointsPerMs</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.dataPointsPerMs" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get 'data points per ms'.</p>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.errorReport">
<code class="highlight language-python"><span class="n">errorReport</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.errorReport" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Generate an error report, one row per error. Spikes can have more than one error.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(pandas DataFrame)</code></td>
      <td><p>Pandas DataFrame, one row per error.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">errorReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generate an error report, one row per error. Spikes can have more than one error.</span>

<span class="sd">	Returns:</span>
<span class="sd">		(pandas DataFrame): Pandas DataFrame, one row per error.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">dictList</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="n">numError</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">errorList</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">spikeIdx</span><span class="p">,</span> <span class="n">spike</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spike</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]):</span>
			<span class="c1"># error is dict from _getErorDict</span>
			<span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">error</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="ow">or</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;nan&#39;</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">dictList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dictList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">fakeErrorDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getErrorDict</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fake&#39;</span><span class="p">,</span> <span class="s1">&#39;fake&#39;</span><span class="p">)</span>
		<span class="n">dfError</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">fakeErrorDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">dfError</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dictList</span><span class="p">)</span>

	<span class="c1">#print(&#39;bAnalysis.errorReport() returning len(dfError):&#39;, len(dfError))</span>
	<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dfError</span><span class="p">)</span><span class="si">}</span><span class="s1"> errors in spike detection&#39;</span><span class="p">)</span>

	<span class="c1">#</span>
	<span class="k">return</span> <span class="n">dfError</span>
</code></pre></div>
        </details>
    </div>

  </div>














  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.getDefaultDetection">
<code class="highlight language-python"><span class="n">getDefaultDetection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.getDefaultDetection" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get default detection dictionary, pass this to <a href="#sanpy.bAnalysis.bAnalysis.spikeDetect">bAnalysis.spikeDetect()</a></p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Dictionary of detection parameters.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">getDefaultDetection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Get default detection dictionary, pass this to [bAnalysis.spikeDetect()][sanpy.bAnalysis.bAnalysis.spikeDetect]</span>

<span class="sd">	Returns:</span>
<span class="sd">		dict: Dictionary of detection parameters.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">mvThreshold</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
	<span class="n">theDict</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;dvdtThreshold&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">#if None then detect only using mvThreshold</span>
		<span class="s1">&#39;mvThreshold&#39;</span><span class="p">:</span> <span class="n">mvThreshold</span><span class="p">,</span>
		<span class="s1">&#39;medianFilter&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
		<span class="s1">&#39;SavitzkyGolay_pnts&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="c1"># shoould correspond to about 0.5 ms</span>
		<span class="s1">&#39;SavitzkyGolay_poly&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
		<span class="s1">&#39;halfHeights&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
		<span class="c1"># new 20210501</span>
		<span class="s1">&#39;mdp_ms&#39;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="c1"># window before/after peak to look for MDP</span>
		<span class="s1">&#39;refractory_ms&#39;</span><span class="p">:</span> <span class="mi">170</span><span class="p">,</span> <span class="c1"># rreject spikes with instantaneous frequency</span>
		<span class="s1">&#39;peakWindow_ms&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">#10, # time after spike to look for AP peak</span>
		<span class="s1">&#39;dvdtPreWindow_ms&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="c1">#5, # used in dvdt, pre-roll to then search for real threshold crossing</span>
		<span class="s1">&#39;avgWindow_ms&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
		<span class="c1"># 20210425, trying 0.15</span>
		<span class="c1">#&#39;dvdt_percentOfMax&#39;: 0.1, # only used in dvdt detection, used to back up spike threshold to more meaningful value</span>
		<span class="s1">&#39;dvdt_percentOfMax&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="c1"># only used in dvdt detection, used to back up spike threshold to more meaningful value</span>
		<span class="c1"># 20210413, was 50 for manuscript, we were missing lots of 1/2 widths</span>
		<span class="s1">&#39;halfWidthWindow_ms&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="c1">#200, #20,</span>
		<span class="c1"># add 20210413 to turn of doBackupSpikeVm on pure vm detection</span>
		<span class="s1">&#39;doBackupSpikeVm&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
		<span class="s1">&#39;spikeClipWidth_ms&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
		<span class="s1">&#39;onlyPeaksAbove_mV&#39;</span><span class="p">:</span> <span class="n">mvThreshold</span><span class="p">,</span>
		<span class="s1">&#39;startSeconds&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># not used ???</span>
		<span class="s1">&#39;stopSeconds&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>

		<span class="c1"># for detection of Ca from line scans</span>
		<span class="c1">#&#39;caThresholdPos&#39;: 0.01,</span>
		<span class="c1">#&#39;caMinSpike&#39;: 0.5,</span>

		<span class="c1"># todo: get rid of this</span>
		<span class="c1"># book keeping like (&#39;cellType&#39;, &#39;sex&#39;, &#39;condition&#39;)</span>
		<span class="s1">&#39;cellType&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
		<span class="s1">&#39;sex&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
		<span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">theDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.getDefaultDetection_ca">
<code class="highlight language-python"><span class="n">getDefaultDetection_ca</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.getDefaultDetection_ca" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get default detection for Ca analysis. Warning, this is currently experimental.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Dictionary of detection parameters.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">getDefaultDetection_ca</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Get default detection for Ca analysis. Warning, this is currently experimental.</span>

<span class="sd">	Returns:</span>
<span class="sd">		dict: Dictionary of detection parameters.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">theDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultDetection</span><span class="p">()</span>
	<span class="n">theDict</span><span class="p">[</span><span class="s1">&#39;dvdtThreshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1">#if None then detect only using mvThreshold</span>
	<span class="n">theDict</span><span class="p">[</span><span class="s1">&#39;mvThreshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
	<span class="c1">#</span>
	<span class="c1">#theDict[&#39;medianFilter&#39;: 0</span>
	<span class="c1">#&#39;halfHeights&#39;: [20,50,80]</span>
	<span class="n">theDict</span><span class="p">[</span><span class="s1">&#39;refractory_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1">#170 # reject spikes with instantaneous frequency</span>
	<span class="c1">#theDict[&#39;peakWindow_ms&#39;: 100 #10, # time after spike to look for AP peak</span>
	<span class="c1">#theDict[&#39;dvdtPreWindow_ms&#39;: 2 # used in dvdt, pre-roll to then search for real threshold crossing</span>
	<span class="c1">#theDict[&#39;avgWindow_ms&#39;: 5</span>
	<span class="c1">#theDict[&#39;dvdt_percentOfMax&#39;: 0.1</span>
	<span class="n">theDict</span><span class="p">[</span><span class="s1">&#39;halfWidthWindow_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1">#was 20</span>
	<span class="c1">#theDict[&#39;spikeClipWidth_ms&#39;: 500</span>
	<span class="c1">#theDict[&#39;onlyPeaksAbove_mV&#39;: None</span>
	<span class="c1">#theDict[&#39;startSeconds&#39;: None</span>
	<span class="c1">#theDict[&#39;stopSeconds&#39;: None</span>

	<span class="c1"># for detection of Ca from line scans</span>
	<span class="c1">#theDict[&#39;caThresholdPos&#39;] = 0.01</span>
	<span class="c1">#theDict[&#39;caMinSpike&#39;] = 0.5</span>

	<span class="k">return</span> <span class="n">theDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.getSpikeClips">
<code class="highlight language-python"><span class="n">getSpikeClips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theMin</span><span class="p">,</span> <span class="n">theMax</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.getSpikeClips" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>get 2d list of spike clips, spike clips x, and 1d mean spike clip</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>theMin</code></td>
        <td><code>float</code></td>
        <td><p>Start seconds.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>theMax</code></td>
        <td><code>float</code></td>
        <td><p>Stop seconds.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">getSpikeClips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theMin</span><span class="p">,</span> <span class="n">theMax</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	get 2d list of spike clips, spike clips x, and 1d mean spike clip</span>

<span class="sd">	Args:</span>
<span class="sd">		theMin (float): Start seconds.</span>
<span class="sd">		theMax (float): Stop seconds.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">theMin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">theMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">theMin</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">theMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweepX</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

	<span class="c1"># make a list of clips within start/stop (Seconds)</span>
	<span class="n">theseClips</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">theseClips_x</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">tmpClips</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># for mean clip</span>
	<span class="n">meanClip</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="c1">#if start is not None and stop is not None:</span>
	<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">clip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeClips</span><span class="p">):</span>
		<span class="n">spikeTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
		<span class="n">spikeTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pnt2Sec_</span><span class="p">(</span><span class="n">spikeTime</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">spikeTime</span><span class="o">&gt;=</span><span class="n">theMin</span> <span class="ow">and</span> <span class="n">spikeTime</span><span class="o">&lt;=</span><span class="n">theMax</span><span class="p">:</span>
			<span class="n">theseClips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clip</span><span class="p">)</span>
			<span class="n">theseClips_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x2</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="c1"># remember, all _x are the same</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">clip</span><span class="p">):</span>
				<span class="n">tmpClips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clip</span><span class="p">)</span> <span class="c1"># for mean clip</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpClips</span><span class="p">):</span>
		<span class="n">meanClip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tmpClips</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">theseClips</span><span class="p">,</span> <span class="n">theseClips_x</span><span class="p">,</span> <span class="n">meanClip</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.getStat">
<code class="highlight language-python"><span class="n">getStat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statName1</span><span class="p">,</span> <span class="n">statName2</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.getStat" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get a list of values for one or two analysis parameters.</p>
<p>For a list of available parameters use xxx.</p>
<p>If the returned list of analysis parameters are in points, convert to seconds or ms using: pnt2Sec_(pnt) or pnt2Ms_(pnt).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>statName1</code></td>
        <td><code>str</code></td>
        <td><p>Name of the first analysis parameter to retreive.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>statName2</code></td>
        <td><code>str</code></td>
        <td><p>Optional, Name of the second analysis parameter to retreive.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>List of analysis parameter values, None if error.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">getStat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statName1</span><span class="p">,</span> <span class="n">statName2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Get a list of values for one or two analysis parameters.</span>

<span class="sd">	For a list of available parameters use xxx.</span>

<span class="sd">	If the returned list of analysis parameters are in points, convert to seconds or ms using: pnt2Sec_(pnt) or pnt2Ms_(pnt).</span>

<span class="sd">	Args:</span>
<span class="sd">		statName1 (str): Name of the first analysis parameter to retreive.</span>
<span class="sd">		statName2 (str): Optional, Name of the second analysis parameter to retreive.</span>

<span class="sd">	Returns:</span>
<span class="sd">		list: List of analysis parameter values, None if error.</span>

<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">val</span>

	<span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="n">error</span> <span class="o">=</span> <span class="kc">False</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="c1">#print(&#39;error bAnalysis.getStat(), there are no spikes&#39;)</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
	<span class="k">elif</span> <span class="ow">not</span> <span class="n">statName1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error: bAnalysis.getStat() did not find statName1&#39;</span><span class="p">,</span> <span class="n">statName1</span><span class="p">,</span> <span class="s1">&#39;in spikeDict&#39;</span><span class="p">)</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
	<span class="k">elif</span> <span class="n">statName2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">statName2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error: bAnalysis.getStat() did not find statName2&#39;</span><span class="p">,</span> <span class="n">statName2</span><span class="p">,</span> <span class="s1">&#39;in spikeDict&#39;</span><span class="p">)</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
		<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean</span><span class="p">(</span><span class="n">spike</span><span class="p">[</span><span class="n">statName1</span><span class="p">])</span> <span class="k">for</span> <span class="n">spike</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">statName2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean</span><span class="p">(</span><span class="n">spike</span><span class="p">[</span><span class="n">statName2</span><span class="p">])</span> <span class="k">for</span> <span class="n">spike</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">statName2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">x</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.getStatMean">
<code class="highlight language-python"><span class="n">getStatMean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statName</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.getStatMean" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get the mean of an analysis parameter.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>statName</code></td>
        <td><code>str</code></td>
        <td><p>Name of the statistic to retreive. For a list of available stats use xxx.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">getStatMean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statName</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Get the mean of an analysis parameter.</span>

<span class="sd">	Args:</span>
<span class="sd">		statName (str): Name of the statistic to retreive. For a list of available stats use xxx.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">theMean</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStat</span><span class="p">(</span><span class="n">statName</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
		<span class="n">theMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">theMean</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.makeSpikeClips">
<code class="highlight language-python"><span class="n">makeSpikeClips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spikeClipWidth_ms</span><span class="p">,</span> <span class="n">theseTime_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.makeSpikeClips" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>(Internal) Make small clips for each spike.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>spikeClipWidth_ms</code></td>
        <td><code>int</code></td>
        <td><p>Width of each spike clip in milliseconds.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>theseTime_sec</code></td>
        <td><code>list of float</code></td>
        <td><p>List of seconds to make clips from.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>spikeClips_x2</code></td>
      <td><p>ms
spikeClips: sweepY</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">makeSpikeClips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spikeClipWidth_ms</span><span class="p">,</span> <span class="n">theseTime_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	(Internal) Make small clips for each spike.</span>

<span class="sd">	Args:</span>
<span class="sd">		spikeClipWidth_ms (int): Width of each spike clip in milliseconds.</span>
<span class="sd">		theseTime_sec (list of float): List of seconds to make clips from.</span>

<span class="sd">	Returns:</span>
<span class="sd">		spikeClips_x2: ms</span>
<span class="sd">		spikeClips: sweepY</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1">#print(&#39;makeSpikeClips() spikeClipWidth_ms:&#39;, spikeClipWidth_ms, &#39;theseTime_sec:&#39;, theseTime_sec)</span>
	<span class="k">if</span> <span class="n">theseTime_sec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">theseTime_pnts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="c1"># convert theseTime_sec to pnts</span>
		<span class="n">theseTime_ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">theseTime_sec</span><span class="p">]</span>
		<span class="n">theseTime_pnts</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">theseTime_ms</span><span class="p">]</span>
		<span class="n">theseTime_pnts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">theseTime_pnts</span><span class="p">]</span>

	<span class="n">clipWidth_pnts</span> <span class="o">=</span> <span class="n">spikeClipWidth_ms</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>
	<span class="n">clipWidth_pnts</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">clipWidth_pnts</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">clipWidth_pnts</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">pass</span> <span class="c1"># Even</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">clipWidth_pnts</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># Make odd even</span>

	<span class="n">halfClipWidth_pnts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">clipWidth_pnts</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

	<span class="c1">#print(&#39;  makeSpikeClips() clipWidth_pnts:&#39;, clipWidth_pnts, &#39;halfClipWidth_pnts:&#39;, halfClipWidth_pnts)</span>
	<span class="c1"># make one x axis clip with the threshold crossing at 0</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">-</span><span class="n">halfClipWidth_pnts</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">clipWidth_pnts</span><span class="p">)]</span>

	<span class="c1">#20190714, added this to make all clips same length, much easier to plot in MultiLine</span>
	<span class="n">numPointsInClip</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x2</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="c1">#for idx, spikeTime in enumerate(self.spikeTimes):</span>
	<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">spikeTime</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theseTime_pnts</span><span class="p">):</span>
		<span class="c1">#currentClip = vm[spikeTime-halfClipWidth_pnts:spikeTime+halfClipWidth_pnts]</span>
		<span class="n">currentClip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweepY</span><span class="p">[</span><span class="n">spikeTime</span><span class="o">-</span><span class="n">halfClipWidth_pnts</span><span class="p">:</span><span class="n">spikeTime</span><span class="o">+</span><span class="n">halfClipWidth_pnts</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentClip</span><span class="p">)</span> <span class="o">==</span> <span class="n">numPointsInClip</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentClip</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x</span><span class="p">)</span> <span class="c1"># a 2D version to make pyqtgraph multiline happy</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">pass</span>
			<span class="c1">##</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  ERROR: bAnalysis.spikeDetect() did not add clip for spike index&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;at time&#39;</span><span class="p">,</span> <span class="n">spikeTime</span><span class="p">,</span> <span class="s1">&#39;currentClip:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentClip</span><span class="p">),</span> <span class="s1">&#39;numPointsInClip:&#39;</span><span class="p">,</span> <span class="n">numPointsInClip</span><span class="p">)</span>
			<span class="c1">##</span>

	<span class="c1">#</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeClips</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.ms2Pnt_">
<code class="highlight language-python"><span class="n">ms2Pnt_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.ms2Pnt_" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Convert milliseconds (ms) to point in recording using <code>self.dataPointsPerMs</code></p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ms</code></td>
        <td><code>float</code></td>
        <td><p>The ms into the recording</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>int</code></td>
      <td><p>The point in the recording</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">ms2Pnt_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert milliseconds (ms) to point in recording using `self.dataPointsPerMs`</span>

<span class="sd">	Args:</span>
<span class="sd">		ms (float): The ms into the recording</span>

<span class="sd">	Returns:</span>
<span class="sd">		int: The point in the recording</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">theRet</span> <span class="o">=</span> <span class="n">ms</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>
	<span class="n">theRet</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">theRet</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">theRet</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.numSpikes">
<code class="highlight language-python"><span class="n">numSpikes</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.numSpikes" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get the number of detected spikes</p>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.numSweeps">
<code class="highlight language-python"><span class="n">numSweeps</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.numSweeps" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get the number of sweeps.</p>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.openHeaderInBrowser">
<code class="highlight language-python"><span class="n">openHeaderInBrowser</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.openHeaderInBrowser" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Open abf file header in browser. Only works for actual abf files.</p>

        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">openHeaderInBrowser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Open abf file header in browser. Only works for actual abf files.&quot;&quot;&quot;</span>
	<span class="c1">#ba.abf.headerLaunch()</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="kn">import</span> <span class="nn">webbrowser</span>
	<span class="n">logFile</span> <span class="o">=</span> <span class="n">sanpy</span><span class="o">.</span><span class="n">sanpyLogger</span><span class="o">.</span><span class="n">getLoggerFile</span><span class="p">()</span>
	<span class="n">htmlFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">logFile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
	<span class="c1">#print(&#39;htmlFile:&#39;, htmlFile)</span>
	<span class="n">html</span> <span class="o">=</span> <span class="n">pyabf</span><span class="o">.</span><span class="n">abfHeaderDisplay</span><span class="o">.</span><span class="n">abfInfoPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abf</span><span class="p">)</span><span class="o">.</span><span class="n">generateHTML</span><span class="p">()</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">htmlFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
	<span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span> <span class="o">+</span> <span class="n">htmlFile</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>








  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.pnt2Ms_">
<code class="highlight language-python"><span class="n">pnt2Ms_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pnt</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.pnt2Ms_" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Convert a point to milliseconds (ms) using <code>self.dataPointsPerMs</code></p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pnt</code></td>
        <td><code>int</code></td>
        <td><p>The point</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>float</code></td>
      <td><p>The point in milliseconds (ms)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pnt2Ms_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pnt</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert a point to milliseconds (ms) using `self.dataPointsPerMs`</span>

<span class="sd">	Args:</span>
<span class="sd">		pnt (int): The point</span>

<span class="sd">	Returns:</span>
<span class="sd">		float: The point in milliseconds (ms)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">pnt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.pnt2Sec_">
<code class="highlight language-python"><span class="n">pnt2Sec_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pnt</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.pnt2Sec_" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Convert a point to Seconds using <code>self.dataPointsPerMs</code></p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pnt</code></td>
        <td><code>int</code></td>
        <td><p>The point</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>float</code></td>
      <td><p>The point in seconds</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pnt2Sec_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pnt</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert a point to Seconds using `self.dataPointsPerMs`</span>

<span class="sd">	Args:</span>
<span class="sd">		pnt (int): The point</span>

<span class="sd">	Returns:</span>
<span class="sd">		float: The point in seconds</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">pnt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pnt</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">pnt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span> <span class="o">/</span> <span class="mi">1000</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.recodingDur">
<code class="highlight language-python"><span class="n">recodingDur</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.recodingDur" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get recording frequency in kHz.</p>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.recordingFrequency">
<code class="highlight language-python"><span class="n">recordingFrequency</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.recordingFrequency" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get recording frequency in kHz.</p>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.save_csv">
<code class="highlight language-python"><span class="n">save_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.save_csv" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Save as a CSV text file with name <path>_analysis.csv'</p>
<p>TODO: Fix
TODO: We need to save header with xxx
TODO: Load <path>_analysis.csv</p>

        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Save as a CSV text file with name &lt;path&gt;_analysis.csv&#39;</span>

<span class="sd">	TODO: Fix</span>
<span class="sd">	TODO: We need to save header with xxx</span>
<span class="sd">	TODO: Load &lt;path&gt;_analysis.csv</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">savefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">savefile</span> <span class="o">+=</span> <span class="s1">&#39;_analysis.csv&#39;</span>
	<span class="n">saveExcel</span> <span class="o">=</span> <span class="kc">False</span>
	<span class="n">alsoSaveTxt</span> <span class="o">=</span> <span class="kc">True</span>
	<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving &quot;</span><span class="si">{</span><span class="n">savefile</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

	<span class="n">be</span> <span class="o">=</span> <span class="n">sanpy</span><span class="o">.</span><span class="n">bExport</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
	<span class="n">be</span><span class="o">.</span><span class="n">saveReport</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span> <span class="n">saveExcel</span><span class="o">=</span><span class="n">saveExcel</span><span class="p">,</span> <span class="n">alsoSaveTxt</span><span class="o">=</span><span class="n">alsoSaveTxt</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.setSweep">
<code class="highlight language-python"><span class="n">setSweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweepNumber</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.setSweep" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Set the current sweep.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>sweepNumber</code></td>
        <td><code>int</code></td>
        <td><p>The sweep number to set.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>      <p>TODO: Set sweep of underlying abf (if we have one)</p>

        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setSweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweepNumber</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Set the current sweep.</span>

<span class="sd">	Args:</span>
<span class="sd">		sweepNumber (int): The sweep number to set.</span>

<span class="sd">	TODO: Set sweep of underlying abf (if we have one)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">sweepNumber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweepList</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error: bAnalysis.setSweep() did not find sweep&#39;</span><span class="p">,</span> <span class="n">sweepNumber</span><span class="p">,</span> <span class="s1">&#39;, sweepList =&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweepList</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">False</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_currentSweep</span> <span class="o">=</span> <span class="n">sweepNumber</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">abf</span><span class="o">.</span><span class="n">setSweep</span><span class="p">(</span><span class="n">sweepNumber</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.spikeDetect">
<code class="highlight language-python"><span class="n">spikeDetect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dDict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.spikeDetect" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Spike detect the current sweep and put results into <code>self.spikeDict[]</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>dDict</code></td>
        <td><code>dict</code></td>
        <td><p>A detection dictionary from <a href="#sanpy.bAnalysis.bAnalysis.getDefaultDetection">bAnalysis.getDefaultDetection()</a></p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>sanpy/bAnalysis.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">spikeDetect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dDict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Spike detect the current sweep and put results into `self.spikeDict[]`.</span>

<span class="sd">	Args:</span>
<span class="sd">		dDict (dict): A detection dictionary from [bAnalysis.getDefaultDetection()][sanpy.bAnalysis.bAnalysis.getDefaultDetection]</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;start detection&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">dDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">dDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultDetection</span><span class="p">()</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">detectionDict</span> <span class="o">=</span> <span class="n">dDict</span> <span class="c1"># remember the parameters of our last detection</span>

	<span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordingMode</span> <span class="o">==</span> <span class="s1">&#39;I-Clamp&#39;</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_getDerivative</span><span class="p">(</span><span class="n">dDict</span><span class="p">)</span>
	<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordingMode</span> <span class="o">==</span> <span class="s1">&#39;V-Clamp&#39;</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_getBaselineSubtract</span><span class="p">(</span><span class="n">dDict</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="c1"># in case recordingMode is ill defined</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_getDerivative</span><span class="p">(</span><span class="n">dDict</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># we are filling this in, one dict for each spike</span>

	<span class="n">detectionType</span> <span class="o">=</span> <span class="kc">None</span>

	<span class="c1">#</span>
	<span class="c1"># spike detect</span>
	<span class="k">if</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;dvdtThreshold&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;dvdtThreshold&#39;</span><span class="p">]):</span>
		<span class="c1"># detect using mV threshold</span>
		<span class="n">detectionType</span> <span class="o">=</span> <span class="s1">&#39;mv&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">,</span> <span class="n">spikeErrorList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spikeDetect_vm</span><span class="p">(</span><span class="n">dDict</span><span class="p">)</span>

		<span class="c1"># backup childish vm threshold</span>
		<span class="k">if</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;doBackupSpikeVm&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backupSpikeVm</span><span class="p">(</span><span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;medianFilter&#39;</span><span class="p">])</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="c1"># detect using dv/dt threshold AND min mV</span>
		<span class="n">detectionType</span> <span class="o">=</span> <span class="s1">&#39;dvdt&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">,</span> <span class="n">spikeErrorList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spikeDetect_dvdt</span><span class="p">(</span><span class="n">dDict</span><span class="p">)</span>

	<span class="n">vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filteredVm</span>
	<span class="n">dvdt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filteredDeriv</span>

	<span class="c1">#</span>
	<span class="c1"># look in a window after each threshold crossing to get AP peak</span>
	<span class="n">peakWindow_pnts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span> <span class="o">*</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;peakWindow_ms&#39;</span><span class="p">]</span>
	<span class="n">peakWindow_pnts</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">peakWindow_pnts</span><span class="p">)</span>

	<span class="c1">#</span>
	<span class="c1"># throw out spikes that have peak below onlyPeaksAbove_mV</span>
	<span class="n">newSpikeTimes</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">newSpikeErrorList</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">if</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;onlyPeaksAbove_mV&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spikeTime</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">):</span>
			<span class="n">peakPnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">vm</span><span class="p">[</span><span class="n">spikeTime</span><span class="p">:</span><span class="n">spikeTime</span><span class="o">+</span><span class="n">peakWindow_pnts</span><span class="p">])</span>
			<span class="n">peakPnt</span> <span class="o">+=</span> <span class="n">spikeTime</span>
			<span class="n">peakVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vm</span><span class="p">[</span><span class="n">spikeTime</span><span class="p">:</span><span class="n">spikeTime</span><span class="o">+</span><span class="n">peakWindow_pnts</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">peakVal</span> <span class="o">&gt;</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;onlyPeaksAbove_mV&#39;</span><span class="p">]:</span>
				<span class="n">newSpikeTimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spikeTime</span><span class="p">)</span>
				<span class="n">newSpikeErrorList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spikeErrorList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;spikeDetect() peak height: rejecting spike&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;at pnt:&#39;</span><span class="p">,</span> <span class="n">spikeTime</span><span class="p">,</span> <span class="s2">&quot;dDict[&#39;onlyPeaksAbove_mV&#39;]:&quot;</span><span class="p">,</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;onlyPeaksAbove_mV&#39;</span><span class="p">])</span>
		<span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span> <span class="o">=</span> <span class="n">newSpikeTimes</span>
		<span class="n">spikeErrorList</span> <span class="o">=</span> <span class="n">newSpikeErrorList</span>

	<span class="c1">#</span>
	<span class="c1"># throw out spikes on a down-slope</span>
	<span class="n">avgWindow_pnts</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;avgWindow_ms&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>
	<span class="n">avgWindow_pnts</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">avgWindow_pnts</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spikeTime</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">):</span>
		<span class="c1"># spikeTime units is ALWAYS points</span>

		<span class="n">peakPnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">vm</span><span class="p">[</span><span class="n">spikeTime</span><span class="p">:</span><span class="n">spikeTime</span><span class="o">+</span><span class="n">peakWindow_pnts</span><span class="p">])</span>
		<span class="n">peakPnt</span> <span class="o">+=</span> <span class="n">spikeTime</span>
		<span class="n">peakVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vm</span><span class="p">[</span><span class="n">spikeTime</span><span class="p">:</span><span class="n">spikeTime</span><span class="o">+</span><span class="n">peakWindow_pnts</span><span class="p">])</span>

		<span class="n">spikeDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="c1"># use OrderedDict so Pandas output is in the correct order</span>

		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;analysisVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sanpy</span><span class="o">.</span><span class="n">analysisVersion</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;interfaceVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sanpy</span><span class="o">.</span><span class="n">interfaceVersion</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span>

		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;detectionType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectionType</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;cellType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;cellType&#39;</span><span class="p">]</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span>

		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;spikeNumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="c1"># append existing spikeErrorList from spikeDetect_dvdt() or spikeDetect_mv()</span>
		<span class="n">tmpError</span> <span class="o">=</span> <span class="n">spikeErrorList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">tmpError</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tmpError</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
			<span class="c1">#spikeDict[&#39;numError&#39;] += 1</span>
			<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpError</span><span class="p">)</span> <span class="c1"># tmpError is from:</span>
						<span class="c1">#eDict = self._getErrorDict(i, spikeTime, errType, errStr) # spikeTime is in pnts</span>

		<span class="c1"># detection params</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;dvdtThreshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;dvdtThreshold&#39;</span><span class="p">]</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;mvThreshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;mvThreshold&#39;</span><span class="p">]</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;medianFilter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;medianFilter&#39;</span><span class="p">]</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;halfHeights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;halfHeights&#39;</span><span class="p">]</span>

		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdPnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spikeTime</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdVal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">spikeTime</span><span class="p">]</span> <span class="c1"># in vm</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdVal_dvdt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvdt</span><span class="p">[</span><span class="n">spikeTime</span><span class="p">]</span> <span class="c1"># in dvdt</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdSec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">spikeTime</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>

		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;peakPnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peakPnt</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;peakVal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peakVal</span>
		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;peakSec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">peakPnt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>

		<span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;peakHeight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;peakVal&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdVal&#39;</span><span class="p">]</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spikeDict</span><span class="p">)</span>

		<span class="n">defaultVal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

		<span class="c1"># get pre/post spike minima</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preMinPnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preMinVal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span>
		<span class="c1">#self.spikeDict[i][&#39;postMinPnt&#39;] = None</span>
		<span class="c1">#self.spikeDict[i][&#39;postMinVal&#39;] = defaultVal</span>

		<span class="c1"># early diastolic duration</span>
		<span class="c1"># 0.1 to 0.5 of time between pre spike min and spike time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preLinearFitPnt0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preLinearFitPnt1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;earlyDiastolicDuration_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># seconds between preLinearFitPnt0 and preLinearFitPnt1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preLinearFitVal0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preLinearFitVal1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span>
		<span class="c1"># m,b = np.polyfit(x, y, 1)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;earlyDiastolicDurationRate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># fit of y=preLinearFitVal 0/1 versus x=preLinearFitPnt 0/1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lateDiastolicDuration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1">#</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preSpike_dvdt_max_pnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preSpike_dvdt_max_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># in units mV</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preSpike_dvdt_max_val2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># in units dv/dt</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;postSpike_dvdt_min_pnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;postSpike_dvdt_min_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># in units mV</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;postSpike_dvdt_min_val2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># in units dv/dt</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;isi_pnts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># time between successive AP thresholds (thresholdSec)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;isi_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># time between successive AP thresholds (thresholdSec)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;spikeFreq_hz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># time between successive AP thresholds (thresholdSec)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cycleLength_pnts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># time between successive MDPs</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cycleLength_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span> <span class="c1"># time between successive MDPs</span>

		<span class="c1"># Action potential duration (APD) was defined as the interval between the TOP and the subsequent MDP</span>
		<span class="c1">#self.spikeDict[i][&#39;apDuration_ms&#39;] = defaultVal</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;diastolicDuration_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span>

		<span class="c1"># any number of spike widths</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;widths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">halfHeight</span> <span class="ow">in</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;halfHeights&#39;</span><span class="p">]:</span>
			<span class="n">widthDict</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s1">&#39;halfHeight&#39;</span><span class="p">:</span> <span class="n">halfHeight</span><span class="p">,</span>
				<span class="s1">&#39;risingPnt&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
				<span class="s1">&#39;risingVal&#39;</span><span class="p">:</span> <span class="n">defaultVal</span><span class="p">,</span>
				<span class="s1">&#39;fallingPnt&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
				<span class="s1">&#39;fallingVal&#39;</span><span class="p">:</span> <span class="n">defaultVal</span><span class="p">,</span>
				<span class="s1">&#39;widthPnts&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
				<span class="s1">&#39;widthMs&#39;</span><span class="p">:</span> <span class="n">defaultVal</span>
			<span class="p">}</span>
			<span class="c1"># abb 20210125, make column width_&lt;n&gt; where &lt;n&gt; is &#39;halfHeight&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;widths_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">halfHeight</span><span class="p">)]</span> <span class="o">=</span> <span class="n">defaultVal</span>
			<span class="c1"># was this</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;widths&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widthDict</span><span class="p">)</span>

		<span class="c1"># The nonlinear late diastolic depolarization phase was estimated as the duration between 1% and 10% dV/dt</span>
		<span class="c1"># todo: not done !!!!!!!!!!</span>

		<span class="c1"># 20210413, was this. This next block is for pre spike analysis</span>
		<span class="c1">#			ok if we are at last spike</span>
		<span class="c1">#if i==0 or i==len(self.spikeTimes)-1:</span>
		<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
			<span class="c1"># was continue but moved half width out of here</span>
			<span class="k">pass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">mdp_ms</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;mdp_ms&#39;</span><span class="p">]</span>
			<span class="n">mdp_pnts</span> <span class="o">=</span> <span class="n">mdp_ms</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>
			<span class="c1">#print(&#39;bAnalysis.spikeDetect() needs to be int mdp_pnts:&#39;, mdp_pnts)</span>
			<span class="n">mdp_pnts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mdp_pnts</span><span class="p">)</span>
			<span class="c1">#</span>
			<span class="c1"># pre spike min</span>
			<span class="c1">#preRange = vm[self.spikeTimes[i-1]:self.spikeTimes[i]]</span>
			<span class="n">startPnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mdp_pnts</span>
			<span class="c1">#print(&#39;  xxx preRange:&#39;, i, startPnt, self.spikeTimes[i])</span>
			<span class="k">if</span> <span class="n">startPnt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
				<span class="c1"># for V-Clammp</span>
				<span class="n">startPnt</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">preRange</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">startPnt</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="c1"># EXCEPTION</span>
			<span class="n">preMinPnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">preRange</span><span class="p">)</span>
			<span class="c1">#preMinPnt += self.spikeTimes[i-1]</span>
			<span class="n">preMinPnt</span> <span class="o">+=</span> <span class="n">startPnt</span>
			<span class="c1"># the pre min is actually an average around the real minima</span>
			<span class="n">avgRange</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">preMinPnt</span><span class="o">-</span><span class="n">avgWindow_pnts</span><span class="p">:</span><span class="n">preMinPnt</span><span class="o">+</span><span class="n">avgWindow_pnts</span><span class="p">]</span>
			<span class="n">preMinVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">avgRange</span><span class="p">)</span>

			<span class="c1"># search backward from spike to find when vm reaches preMinVal (avg)</span>
			<span class="n">preRange</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">preMinPnt</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
			<span class="n">preRange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">preRange</span><span class="p">)</span> <span class="c1"># we want to search backwards from peak</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">preMinPnt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">preRange</span><span class="o">&lt;</span><span class="n">preMinVal</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">preMinPnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">preMinPnt2</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preMinPnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preMinPnt</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preMinVal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preMinVal</span>

			<span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
				<span class="c1">#self.spikeDict[i][&#39;numError&#39;] = self.spikeDict[i][&#39;numError&#39;] + 1</span>
				<span class="c1"># sometimes preRange is empty, don&#39;t try and put min/max in error</span>
				<span class="c1">#print(&#39;heroku preMinValue error !!!!!!!!!!!!!!!&#39;)</span>
				<span class="c1">#print(&#39;  &#39;, self.spikeDict[i])</span>
				<span class="n">errorStr</span> <span class="o">=</span> <span class="s1">&#39;searching for preMinVal:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">preMinVal</span><span class="p">)</span> <span class="c1">#+ &#39; postRange min:&#39; + str(np.min(postRange)) + &#39; max &#39; + str(np.max(postRange))</span>
				<span class="n">eDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getErrorDict</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;preMin&#39;</span><span class="p">,</span> <span class="n">errorStr</span><span class="p">)</span> <span class="c1"># spikeTime is in pnts</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eDict</span><span class="p">)</span>

			<span class="c1">#</span>
			<span class="c1"># linear fit on 10% - 50% of the time from preMinPnt to self.spikeTimes[i]</span>
			<span class="n">startLinearFit</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># percent of time between pre spike min and AP peak</span>
			<span class="n">stopLinearFit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># percent of time between pre spike min and AP peak</span>
			<span class="c1"># taking floor() so we always get an integer # points</span>
			<span class="n">timeInterval_pnts</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">preMinPnt</span><span class="p">)</span>
			<span class="n">preLinearFitPnt0</span> <span class="o">=</span> <span class="n">preMinPnt</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">timeInterval_pnts</span> <span class="o">*</span> <span class="n">startLinearFit</span><span class="p">)</span>
			<span class="n">preLinearFitPnt1</span> <span class="o">=</span> <span class="n">preMinPnt</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">timeInterval_pnts</span> <span class="o">*</span> <span class="n">stopLinearFit</span><span class="p">)</span>
			<span class="n">preLinearFitVal0</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">preLinearFitPnt0</span><span class="p">]</span>
			<span class="n">preLinearFitVal1</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">preLinearFitPnt1</span><span class="p">]</span>

			<span class="c1"># linear fit before spike</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preLinearFitPnt0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preLinearFitPnt0</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preLinearFitPnt1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preLinearFitPnt1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;earlyDiastolicDuration_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pnt2Ms_</span><span class="p">(</span><span class="n">preLinearFitPnt1</span> <span class="o">-</span> <span class="n">preLinearFitPnt0</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preLinearFitVal0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preLinearFitVal0</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preLinearFitVal1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preLinearFitVal1</span>

			<span class="c1"># a linear fit where &#39;m,b = np.polyfit(x, y, 1)&#39;</span>
			<span class="c1"># m*x+b&quot;</span>
			<span class="n">xFit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweepX</span><span class="p">[</span><span class="n">preLinearFitPnt0</span><span class="p">:</span><span class="n">preLinearFitPnt1</span><span class="p">]</span>
			<span class="n">yFit</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">preLinearFitPnt0</span><span class="p">:</span><span class="n">preLinearFitPnt1</span><span class="p">]</span>
			<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
				<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">mLinear</span><span class="p">,</span> <span class="n">bLinear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xFit</span><span class="p">,</span> <span class="n">yFit</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># m is slope, b is intercept</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;earlyDiastolicDurationRate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mLinear</span>
				<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
					<span class="c1">#catching exception: raise TypeError(&quot;expected non-empty vector for x&quot;)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;earlyDiastolicDurationRate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span>
					<span class="n">errorStr</span> <span class="o">=</span> <span class="s1">&#39;earlyDiastolicDurationRate fit&#39;</span>
					<span class="n">eDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getErrorDict</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;fitEDD&#39;</span><span class="p">,</span> <span class="n">errorStr</span><span class="p">)</span> <span class="c1"># spikeTime is in pnts</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eDict</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">RankWarning</span><span class="p">:</span>
					<span class="c1"># also throws: RankWarning: Polyfit may be poorly conditioned</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;earlyDiastolicDurationRate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultVal</span>
					<span class="n">errorStr</span> <span class="o">=</span> <span class="s1">&#39;earlyDiastolicDurationRate fit - RankWarning&#39;</span>
					<span class="n">eDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getErrorDict</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;fitEDD2&#39;</span><span class="p">,</span> <span class="n">errorStr</span><span class="p">)</span> <span class="c1"># spikeTime is in pnts</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eDict</span><span class="p">)</span>

			<span class="c1"># not implemented</span>
			<span class="c1">#self.spikeDict[i][&#39;lateDiastolicDuration&#39;] = ???</span>

		<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
			<span class="c1">#</span>
			<span class="c1"># maxima in dv/dt before spike</span>
			<span class="c1"># added try/except sunday april 14, seems to break spike detection???</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="c1"># 20210415 was this</span>
				<span class="c1">#preRange = dvdt[self.spikeTimes[i]:peakPnt]</span>
				<span class="n">preRange</span> <span class="o">=</span> <span class="n">dvdt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">peakPnt</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">preSpike_dvdt_max_pnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">preRange</span><span class="p">)</span>
				<span class="n">preSpike_dvdt_max_pnt</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preSpike_dvdt_max_pnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preSpike_dvdt_max_pnt</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preSpike_dvdt_max_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">preSpike_dvdt_max_pnt</span><span class="p">]</span> <span class="c1"># in units mV</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preSpike_dvdt_max_val2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvdt</span><span class="p">[</span><span class="n">preSpike_dvdt_max_pnt</span><span class="p">]</span> <span class="c1"># in units mV</span>
			<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
				<span class="c1">#self.spikeDict[i][&#39;numError&#39;] = self.spikeDict[i][&#39;numError&#39;] + 1</span>
				<span class="c1"># sometimes preRange is empty, don&#39;t try and put min/max in error</span>
				<span class="c1">#print(&#39;preRange:&#39;, preRange)</span>
				<span class="n">errorStr</span> <span class="o">=</span> <span class="s1">&#39;searching for preSpike_dvdt_max_pnt:&#39;</span>
				<span class="n">eDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getErrorDict</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;preSpikeDvDt&#39;</span><span class="p">,</span> <span class="n">errorStr</span><span class="p">)</span> <span class="c1"># spikeTime is in pnts</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eDict</span><span class="p">)</span>

		<span class="c1"># 20210501, we do not need postMin/mdp, not used anywhere else</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		if i==len(self.spikeTimes)-1:</span>
<span class="sd">			# last spike</span>
<span class="sd">			pass</span>
<span class="sd">		else:</span>
<span class="sd">			#</span>
<span class="sd">			# post spike min</span>
<span class="sd">			postRange = vm[self.spikeTimes[i]:self.spikeTimes[i+1]]</span>
<span class="sd">			postMinPnt = np.argmin(postRange)</span>
<span class="sd">			postMinPnt += self.spikeTimes[i]</span>
<span class="sd">			# the post min is actually an average around the real minima</span>
<span class="sd">			avgRange = vm[postMinPnt-avgWindow_pnts:postMinPnt+avgWindow_pnts]</span>
<span class="sd">			postMinVal = np.average(avgRange)</span>

<span class="sd">			# search forward from spike to find when vm reaches postMinVal (avg)</span>
<span class="sd">			postRange = vm[self.spikeTimes[i]:postMinPnt]</span>
<span class="sd">			try:</span>
<span class="sd">				postMinPnt2 = np.where(postRange&lt;postMinVal)[0][0]</span>
<span class="sd">				postMinPnt = self.spikeTimes[i] + postMinPnt2</span>
<span class="sd">				self.spikeDict[i][&#39;postMinPnt&#39;] = postMinPnt</span>
<span class="sd">				self.spikeDict[i][&#39;postMinVal&#39;] = postMinVal</span>
<span class="sd">			except (IndexError) as e:</span>
<span class="sd">				self.spikeDict[i][&#39;numError&#39;] = self.spikeDict[i][&#39;numError&#39;] + 1</span>
<span class="sd">				# sometimes postRange is empty, don&#39;t try and put min/max in error</span>
<span class="sd">				#print(&#39;postRange:&#39;, postRange)</span>
<span class="sd">				errorStr = &#39;searching for postMinVal:&#39; + str(postMinVal) #+ &#39; postRange min:&#39; + str(np.min(postRange)) + &#39; max &#39; + str(np.max(postRange))</span>
<span class="sd">				eDict = self._getErrorDict(i, self.spikeTimes[i], &#39;postMinError&#39;, errorStr) # spikeTime is in pnts</span>
<span class="sd">				self.spikeDict[i][&#39;errors&#39;].append(eDict)</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
			<span class="c1">#</span>
			<span class="c1"># minima in dv/dt after spike</span>
			<span class="c1">#postRange = dvdt[self.spikeTimes[i]:postMinPnt]</span>
			<span class="n">postSpike_ms</span> <span class="o">=</span> <span class="mi">10</span>
			<span class="n">postSpike_pnts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span> <span class="o">*</span> <span class="n">postSpike_ms</span>
			<span class="c1"># abb 20210130 lcr analysis</span>
			<span class="n">postSpike_pnts</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">postSpike_pnts</span><span class="p">)</span>
			<span class="c1">#postRange = dvdt[self.spikeTimes[i]:self.spikeTimes[i]+postSpike_pnts] # fixed window after spike</span>
			<span class="n">postRange</span> <span class="o">=</span> <span class="n">dvdt</span><span class="p">[</span><span class="n">peakPnt</span><span class="p">:</span><span class="n">peakPnt</span><span class="o">+</span><span class="n">postSpike_pnts</span><span class="p">]</span> <span class="c1"># fixed window after spike</span>

			<span class="n">postSpike_dvdt_min_pnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">postRange</span><span class="p">)</span>
			<span class="n">postSpike_dvdt_min_pnt</span> <span class="o">+=</span> <span class="n">peakPnt</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;postSpike_dvdt_min_pnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">postSpike_dvdt_min_pnt</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;postSpike_dvdt_min_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">postSpike_dvdt_min_pnt</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;postSpike_dvdt_min_val2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvdt</span><span class="p">[</span><span class="n">postSpike_dvdt_min_pnt</span><span class="p">]</span>

			<span class="c1"># 202102</span>
			<span class="c1">#self.spikeDict[i][&#39;preMinPnt&#39;] = preMinPnt</span>
			<span class="c1">#self.spikeDict[i][&#39;preMinVal&#39;] = preMinVal</span>
			<span class="c1"># 202102</span>
			<span class="c1">#self.spikeDict[i][&#39;postMinPnt&#39;] = postMinPnt</span>
			<span class="c1">#self.spikeDict[i][&#39;postMinVal&#39;] = postMinVal</span>

			<span class="c1"># linear fit before spike</span>
			<span class="c1">#self.spikeDict[i][&#39;preLinearFitPnt0&#39;] = preLinearFitPnt0</span>
			<span class="c1">#self.spikeDict[i][&#39;preLinearFitPnt1&#39;] = preLinearFitPnt1</span>
			<span class="c1">#self.spikeDict[i][&#39;earlyDiastolicDuration_ms&#39;] = self.pnt2Ms_(preLinearFitPnt1 - preLinearFitPnt0)</span>
			<span class="c1">#self.spikeDict[i][&#39;preLinearFitVal0&#39;] = preLinearFitVal0</span>
			<span class="c1">#self.spikeDict[i][&#39;preLinearFitVal1&#39;] = preLinearFitVal1</span>

			<span class="c1">#</span>
			<span class="c1"># Action potential duration (APD) was defined as</span>
			<span class="c1"># the interval between the TOP and the subsequent MDP</span>
			<span class="c1"># 20210501, removed AP duration, use APD_90, APD_50 etc</span>
			<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			if i==len(self.spikeTimes)-1:</span>
<span class="sd">				pass</span>
<span class="sd">			else:</span>
<span class="sd">				self.spikeDict[i][&#39;apDuration_ms&#39;] = self.pnt2Ms_(postMinPnt - spikeDict[&#39;thresholdPnt&#39;])</span>
<span class="sd">			&#39;&#39;&#39;</span>

			<span class="c1">#</span>
			<span class="c1"># diastolic duration was defined as</span>
			<span class="c1"># the interval between MDP and TOP</span>
			<span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="c1"># one off error when preMinPnt is not defined</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;diastolicDuration_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pnt2Ms_</span><span class="p">(</span><span class="n">spikeTime</span> <span class="o">-</span> <span class="n">preMinPnt</span><span class="p">)</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cycleLength_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="c1">#20190627, was i&gt;1</span>
				<span class="n">isiPnts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;thresholdPnt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;thresholdPnt&#39;</span><span class="p">]</span>
				<span class="n">isi_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pnt2Ms_</span><span class="p">(</span><span class="n">isiPnts</span><span class="p">)</span>
				<span class="n">isi_hz</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">isi_ms</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;isi_pnts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isiPnts</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;isi_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pnt2Ms_</span><span class="p">(</span><span class="n">isiPnts</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;spikeFreq_hz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pnt2Ms_</span><span class="p">(</span><span class="n">isiPnts</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

				<span class="c1"># Cycle length was defined as the interval between MDPs in successive APs</span>
				<span class="n">prevPreMinPnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;preMinPnt&#39;</span><span class="p">]</span> <span class="c1"># can be nan</span>
				<span class="n">thisPreMinPnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;preMinPnt&#39;</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">prevPreMinPnt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">thisPreMinPnt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">cycleLength_pnts</span> <span class="o">=</span> <span class="n">thisPreMinPnt</span> <span class="o">-</span> <span class="n">prevPreMinPnt</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cycleLength_pnts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycleLength_pnts</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cycleLength_ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pnt2Ms_</span><span class="p">(</span><span class="n">cycleLength_pnts</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="c1"># error</span>
					<span class="c1">#self.spikeDict[i][&#39;numError&#39;] = self.spikeDict[i][&#39;numError&#39;] + 1</span>
					<span class="n">errorStr</span> <span class="o">=</span> <span class="s1">&#39;previous spike preMinPnt is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prevPreMinPnt</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; this preMinPnt:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thisPreMinPnt</span><span class="p">)</span>
					<span class="n">eDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getErrorDict</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;cycleLength&#39;</span><span class="p">,</span> <span class="n">errorStr</span><span class="p">)</span> <span class="c1"># spikeTime is in pnts</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eDict</span><span class="p">)</span>
				<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">				# 20210501 was this, I am no longer using postMinPnt</span>
<span class="sd">				prevPostMinPnt = self.spikeDict[i-1][&#39;postMinPnt&#39;]</span>
<span class="sd">				tmpPostMinPnt = self.spikeDict[i][&#39;postMinPnt&#39;]</span>
<span class="sd">				if prevPostMinPnt is not None and tmpPostMinPnt is not None:</span>
<span class="sd">					cycleLength_pnts = tmpPostMinPnt - prevPostMinPnt</span>
<span class="sd">					self.spikeDict[i][&#39;cycleLength_pnts&#39;] = cycleLength_pnts</span>
<span class="sd">					self.spikeDict[i][&#39;cycleLength_ms&#39;] = self.pnt2Ms_(cycleLength_pnts)</span>
<span class="sd">				else:</span>
<span class="sd">					self.spikeDict[i][&#39;numError&#39;] = self.spikeDict[i][&#39;numError&#39;] + 1</span>
<span class="sd">					errorStr = &#39;previous spike postMinPnt is &#39; + str(prevPostMinPnt) + &#39; this postMinPnt:&#39; + str(tmpPostMinPnt)</span>
<span class="sd">					eDict = self._getErrorDict(i, self.spikeTimes[i], &#39;cycleLength&#39;, errorStr) # spikeTime is in pnts</span>
<span class="sd">					self.spikeDict[i][&#39;errors&#39;].append(eDict)</span>
<span class="sd">				&#39;&#39;&#39;</span>
		<span class="c1">#</span>
		<span class="c1"># spike half with and APDur</span>
		<span class="c1">#</span>

		<span class="c1">#</span>
		<span class="c1"># 20210130, moving &#39;half width&#39; out of inner if spike # is first/last</span>
		<span class="c1">#</span>
		<span class="c1"># get 1/2 height (actually, any number of height measurements)</span>
		<span class="c1"># action potential duration using peak and post min</span>
		<span class="c1">#self.spikeDict[i][&#39;widths&#39;] = []</span>
		<span class="c1">#print(&#39;*** calculating half width for spike&#39;, i)</span>
		<span class="n">doWidthVersion2</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="c1">#halfWidthWindow_ms = 20</span>
		<span class="n">hwWindowPnts</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;halfWidthWindow_ms&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>
		<span class="n">hwWindowPnts</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">hwWindowPnts</span><span class="p">)</span>

		<span class="n">tmpPeakSec</span> <span class="o">=</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;peakSec&#39;</span><span class="p">]</span>
		<span class="n">tmpErrorType</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">halfHeight</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;halfHeights&#39;</span><span class="p">]):</span>
			<span class="c1"># halfHeight in [20, 50, 80]</span>
			<span class="k">if</span> <span class="n">doWidthVersion2</span><span class="p">:</span>
				<span class="n">tmpThreshVm</span> <span class="o">=</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdVal&#39;</span><span class="p">]</span>
				<span class="n">thisVm</span> <span class="o">=</span> <span class="n">tmpThreshVm</span> <span class="o">+</span> <span class="p">(</span><span class="n">peakVal</span> <span class="o">-</span> <span class="n">tmpThreshVm</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">halfHeight</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># 20210413 was this</span>
				<span class="c1">#thisVm = postMinVal + (peakVal - postMinVal) * (halfHeight * 0.01)</span>
				<span class="n">tmpThreshVm2</span> <span class="o">=</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdVal&#39;</span><span class="p">]</span>
				<span class="n">thisVm</span> <span class="o">=</span> <span class="n">tmpThreshVm2</span> <span class="o">+</span> <span class="p">(</span><span class="n">peakVal</span> <span class="o">-</span> <span class="n">tmpThreshVm2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">halfHeight</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span>
			<span class="c1">#todo: logic is broken, this get over-written in following try</span>
			<span class="n">widthDict</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s1">&#39;halfHeight&#39;</span><span class="p">:</span> <span class="n">halfHeight</span><span class="p">,</span>
				<span class="s1">&#39;risingPnt&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
				<span class="s1">&#39;risingVal&#39;</span><span class="p">:</span> <span class="n">defaultVal</span><span class="p">,</span>
				<span class="s1">&#39;fallingPnt&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
				<span class="s1">&#39;fallingVal&#39;</span><span class="p">:</span> <span class="n">defaultVal</span><span class="p">,</span>
				<span class="s1">&#39;widthPnts&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
				<span class="s1">&#39;widthMs&#39;</span><span class="p">:</span> <span class="n">defaultVal</span>
			<span class="p">}</span>
			<span class="n">widthMs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">doWidthVersion2</span><span class="p">:</span>
					<span class="n">postRange</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">peakPnt</span><span class="p">:</span><span class="n">peakPnt</span><span class="o">+</span><span class="n">hwWindowPnts</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="c1"># 20210413 was this</span>
					<span class="c1">#postRange = vm[peakPnt:postMinPnt]</span>
					<span class="n">postRange</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">peakPnt</span><span class="p">:</span><span class="n">peakPnt</span><span class="o">+</span><span class="n">hwWindowPnts</span><span class="p">]</span>
				<span class="n">fallingPnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">postRange</span><span class="o">&lt;</span><span class="n">thisVm</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># less than</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fallingPnt</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
					<span class="c1">#error</span>
					<span class="n">tmpErrorType</span> <span class="o">=</span> <span class="s1">&#39;falling point&#39;</span>
					<span class="k">raise</span> <span class="ne">IndexError</span>
				<span class="n">fallingPnt</span> <span class="o">=</span> <span class="n">fallingPnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># first falling point</span>
				<span class="n">fallingPnt</span> <span class="o">+=</span> <span class="n">peakPnt</span>
				<span class="n">fallingVal</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">fallingPnt</span><span class="p">]</span>

				<span class="c1"># use the post/falling to find pre/rising</span>
				<span class="k">if</span> <span class="n">doWidthVersion2</span><span class="p">:</span>
					<span class="n">preRange</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">peakPnt</span><span class="o">-</span><span class="n">hwWindowPnts</span><span class="p">:</span><span class="n">peakPnt</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">tmpPreMinPnt2</span> <span class="o">=</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdPnt&#39;</span><span class="p">]</span>
					<span class="n">preRange</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">tmpPreMinPnt2</span><span class="p">:</span><span class="n">peakPnt</span><span class="p">]</span>
				<span class="n">risingPnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">preRange</span><span class="o">&gt;</span><span class="n">fallingVal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># greater than</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">risingPnt</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
					<span class="c1">#error</span>
					<span class="n">tmpErrorType</span> <span class="o">=</span> <span class="s1">&#39;rising point&#39;</span>
					<span class="k">raise</span> <span class="ne">IndexError</span>
				<span class="n">risingPnt</span> <span class="o">=</span> <span class="n">risingPnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># first falling point</span>

				<span class="k">if</span> <span class="n">doWidthVersion2</span><span class="p">:</span>
					<span class="n">risingPnt</span> <span class="o">+=</span> <span class="n">peakPnt</span><span class="o">-</span><span class="n">hwWindowPnts</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">risingPnt</span> <span class="o">+=</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdPnt&#39;</span><span class="p">]</span>
				<span class="n">risingVal</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">risingPnt</span><span class="p">]</span>

				<span class="c1"># width (pnts)</span>
				<span class="n">widthPnts</span> <span class="o">=</span> <span class="n">fallingPnt</span> <span class="o">-</span> <span class="n">risingPnt</span>
				<span class="c1"># 20210413</span>
				<span class="n">widthPnts2</span> <span class="o">=</span> <span class="n">fallingPnt</span> <span class="o">-</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdPnt&#39;</span><span class="p">]</span>
				<span class="n">tmpRisingPnt</span> <span class="o">=</span> <span class="n">spikeDict</span><span class="p">[</span><span class="s1">&#39;thresholdPnt&#39;</span><span class="p">]</span>
				<span class="c1"># assign</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;halfHeight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">halfHeight</span>
				<span class="c1"># 20210413, put back in</span>
				<span class="c1">#widthDict[&#39;risingPnt&#39;] = risingPnt</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;risingPnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmpRisingPnt</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;risingVal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">risingVal</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;fallingPnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fallingPnt</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;fallingVal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fallingVal</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;widthPnts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widthPnts</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;widthMs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widthPnts</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>
				<span class="n">widthMs</span> <span class="o">=</span> <span class="n">widthPnts</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span> <span class="c1"># abb 20210125</span>
				<span class="c1"># 20210413, todo: make these end in 2</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;widthPnts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widthPnts2</span>
				<span class="n">widthDict</span><span class="p">[</span><span class="s1">&#39;widthMs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widthPnts</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>

			<span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
				<span class="c1">##</span>
				<span class="c1">##</span>
				<span class="c1">#print(&#39;  EXCEPTION: bAnalysis.spikeDetect() spike&#39;, i, &#39;half height&#39;, halfHeight)</span>
				<span class="c1">##</span>
				<span class="c1">##</span>

				<span class="c1">#self.spikeDict[i][&#39;numError&#39;] = self.spikeDict[i][&#39;numError&#39;] + 1</span>
				<span class="c1">#errorStr = &#39;spike &#39; + str(i) + &#39; half width &#39; + str(tmpErrorType) + &#39; &#39; + str(halfHeight) + &#39; halfWidthWindow_ms:&#39; + str(dDict[&#39;halfWidthWindow_ms&#39;])</span>
				<span class="n">errorStr</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;half width </span><span class="si">{</span><span class="n">halfHeight</span><span class="si">}</span><span class="s1"> error in </span><span class="si">{</span><span class="n">tmpErrorType</span><span class="si">}</span><span class="s1"> &#39;</span>
						<span class="sa">f</span><span class="s2">&quot;with halfWidthWindow_ms:</span><span class="si">{</span><span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;halfWidthWindow_ms&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
						<span class="sa">f</span><span class="s1">&#39;searching for Vm:</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">thisVm</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1"> from peak sec </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">tmpPeakSec</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
						<span class="p">)</span>

				<span class="n">eDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getErrorDict</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;spikeWidth&#39;</span><span class="p">,</span> <span class="n">errorStr</span><span class="p">)</span> <span class="c1"># spikeTime is in pnts</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eDict</span><span class="p">)</span>

			<span class="c1"># abb 20210125</span>
			<span class="c1"># wtf is hapenning on Heroku????</span>
			<span class="c1">#print(&#39;**** heroku debug i:&#39;, i, &#39;j:&#39;, j, &#39;len:&#39;, len(self.spikeDict), &#39;halfHeight:&#39;, halfHeight)</span>
			<span class="c1">#print(&#39;  self.spikeDict[i]&#39;, self.spikeDict[i][&#39;widths_&#39;+str(halfHeight)])</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;widths_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">halfHeight</span><span class="p">)]</span> <span class="o">=</span> <span class="n">widthMs</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;widths&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">widthDict</span>

	<span class="c1">#</span>
	<span class="c1"># look between threshold crossing to get minima</span>
	<span class="c1"># we will ignore the first and last spike</span>

	<span class="c1"># todo: call self.makeSpikeClips()</span>
	<span class="c1">#</span>
	<span class="c1"># build a list of spike clips</span>
	<span class="c1">#clipWidth_ms = 500</span>
	<span class="n">clipWidth_pnts</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;spikeClipWidth_ms&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span>
	<span class="n">clipWidth_pnts</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">clipWidth_pnts</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">clipWidth_pnts</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">pass</span> <span class="c1"># Even</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">clipWidth_pnts</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># Odd</span>

	<span class="n">halfClipWidth_pnts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">clipWidth_pnts</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

	<span class="c1">#print(&#39;  spikeDetect() clipWidth_pnts:&#39;, clipWidth_pnts, &#39;halfClipWidth_pnts:&#39;, halfClipWidth_pnts)</span>
	<span class="c1"># make one x axis clip with the threshold crossing at 0</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">-</span><span class="n">halfClipWidth_pnts</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPointsPerMs</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">clipWidth_pnts</span><span class="p">)]</span>

	<span class="c1">#20190714, added this to make all clips same length, much easier to plot in MultiLine</span>
	<span class="n">numPointsInClip</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x2</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">spikeTime</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">):</span>
		<span class="c1">#currentClip = vm[spikeTime-halfClipWidth_pnts:spikeTime+halfClipWidth_pnts]</span>
		<span class="n">currentClip</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="n">spikeTime</span><span class="o">-</span><span class="n">halfClipWidth_pnts</span><span class="p">:</span><span class="n">spikeTime</span><span class="o">+</span><span class="n">halfClipWidth_pnts</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentClip</span><span class="p">)</span> <span class="o">==</span> <span class="n">numPointsInClip</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentClip</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeClips_x</span><span class="p">)</span> <span class="c1"># a 2D version to make pyqtgraph multiline happy</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1">##</span>
			<span class="c1">##</span>
			<span class="k">if</span> <span class="n">idx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">idx</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
				<span class="c1"># don&#39;t report spike clip errors for first/last spike</span>
				<span class="k">pass</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  ERROR: bAnalysis.spikeDetect() did not add clip for spike index&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;at time&#39;</span><span class="p">,</span> <span class="n">spikeTime</span><span class="p">,</span> <span class="s1">&#39;currentClip:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentClip</span><span class="p">),</span> <span class="s1">&#39;numPointsInClip:&#39;</span><span class="p">,</span> <span class="n">numPointsInClip</span><span class="p">)</span>
			<span class="c1">##</span>
			<span class="c1">##</span>

	<span class="c1"># 20210426</span>
	<span class="c1"># generate a df holding stats (used by scatterplotwidget)</span>
	<span class="c1">#print(&#39;  making df to pass to scatterplotwidget&#39;)</span>
	<span class="n">startSeconds</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;startSeconds&#39;</span><span class="p">]</span>
	<span class="n">stopSeconds</span> <span class="o">=</span> <span class="n">dDict</span><span class="p">[</span><span class="s1">&#39;stopSeconds&#39;</span><span class="p">]</span>
	<span class="c1">#tmpAnalysisName, df0 = self.getReportDf(theMin, theMax, savefile)</span>
	<span class="n">exportObject</span> <span class="o">=</span> <span class="n">sanpy</span><span class="o">.</span><span class="n">bExport</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
	<span class="n">dfReportForScatter</span> <span class="o">=</span> <span class="n">exportObject</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">startSeconds</span><span class="p">,</span> <span class="n">stopSeconds</span><span class="p">)</span>

	<span class="n">stopTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
	<span class="c1">#print(&#39;bAnalysis.spikeDetect() for file&#39;, self.file)</span>
	<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Detected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spikeTimes</span><span class="p">)</span><span class="si">}</span><span class="s1"> spikes in </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">stopTime</span><span class="o">-</span><span class="n">startTime</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>
	<span class="c1">#self.errorReport()</span>

	<span class="k">return</span> <span class="n">dfReportForScatter</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 class="doc doc-heading" id="sanpy.bAnalysis.bAnalysis.sweepList">
<code class="highlight language-python"><span class="n">sweepList</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a class="headerlink" href="#sanpy.bAnalysis.bAnalysis.sweepList" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get a list of sweeps.</p>
    </div>

  </div>











  </div>

    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h2 class="doc doc-heading" id="sanpy.bAnalysis.logger">
<code class="highlight language-python"><span class="n">logger</span></code>


<a class="headerlink" href="#sanpy.bAnalysis.logger" title="Permanent link">¤</a></h2>

    <div class="doc doc-contents ">

      <h3 id="sanpy.bAnalysis.logger--was-used-to-check-for-valid-pyabf-but-we-are-now-detached-from-this">was used to check for valid pyAbf but we are now detached from this<a class="headerlink" href="#sanpy.bAnalysis.logger--was-used-to-check-for-valid-pyabf-but-we-are-now-detached-from-this" title="Permanent link">¤</a></h3>
<p>def old_check_abf(func):
        """
        Decorator to return None is self.abf is None
        """
        @wraps(func)
        def inner(self, <em>args, </em><em>kwargs):
                if self.abf is None:
                        #raise ValueError
                        return None
                !!! else
                        return func(self, </em>args, **kwargs)
        return inner</p>
    </div>

  </div>

















  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        my footer
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.expand"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.34eae1b6.min.js"></script>
      
    
  </body>
</html>